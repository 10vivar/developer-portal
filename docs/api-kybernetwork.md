---
id: KyberNetwork
title: KyberNetwork
---
# contract KyberNetwork
is [Withdrawable](api-withdrawable.md), [Utils](api-utils.md)\
imports [ERC20Interface](api-erc-20-interface.md), [KyberReserveInterface](api-kyberreserveinterface.md), [Withdrawable](api-withdrawable.md), [Utils](api-utils.md), [PermissionGroups](api-permissiongroups.md), [WhiteListInterface](api-whitelistinterface.md), [ExpectedRateInterface](api-expectedrateinterface.md), [FeeBurnerInterface](api-feeburnerinterface.md)

*Source*: [KyberNetwork.sol](https://github.com/KyberNetwork/smart-contracts/blob/master/contracts/KyberNetwork.sol)

The KyberNetwork contract's role is to facilitate two main functionalities, which is to return the expect exchange rate, and to execute a trade.
___

## INDEX

<AUTOGENERATED_TABLE_OF_CONTENTS>

## REFERENCE

### Events

### `AddReserveToNetwork`
Event for logging reserve additions or removals from the network.
___
event __AddReserveToNetwork__(KyberReserveInterface reserve, bool add)
| Parameter | Type                  | Description                                                 |
| --------- |:---------------------:|:-----------------------------------------------------------:|
| `reserve` | KyberReserveInterface | reserve's contract address                                  |
| `add`     | bool                  | `true` if reserve was successfully added, otherwise `false` |
<br />

### `EtherReceival`
Event for logging amount of ETH received from sender.
___
event __EtherReceival__(address indexed sender, uint amount)
| Parameter | Type            | Description      |
| --------- |:---------------:|:----------------:|
| `sender`  | indexed address | sender's address |
| `amount`  | uint            | ETH amount sent  |
<br />

### `ExecuteTrade`
Event for logging execution of trades.
___
event __ExecuteTrade__(address indexed sender, ERC20 src, ERC20 dest, uint actualSrcAmount, uint actualDestAmount)
| Parameter          | Type            | Description                              |
| ------------------ |:---------------:|:----------------------------------------:|
| `sender`           | indexed address | sender's address                         |
| `src`              | ERC20           | source ERC20 token contract address      |
| `dest`             | ERC20           | destination ERC20 Token contract address |
| `actualSrcAmount`  | uint            | source ERC20 token amount in wei         |
| `actualDestAmount` | uint            | destination ERC20 token amount in wei    |
<br />

### `ListReservePairs`
Event for logging of listing of token pairs that a reserve is allowed to trade.
___
event __ListReservePairs__(address reserve, ERC20 src, ERC20 dest, bool add)
| Parameter | Type    | Description                                                    |
| ----------|:-------:|:--------------------------------------------------------------:|
| `reserve` | address | reserve's contract address                                     |
| `src`     | ERC20   | source ERC20 token contract address                            |
| `dest`    | ERC20   | destination ERC20 token contract address                       |
| `add`     | bool    | `true` if trades are allowed, otherwise `false` for disallowed |
<br />

### Functions

### `KyberNetwork`
Contract constructor. Note that constructor methods are called exactly once during contract instantiation and cannot be called again.
___
function __KyberNetwork__(address \_admin) public
| Parameter  | Type    | Description            |
| ---------- |:-------:|:----------------------:|
| `_admin`   | address | admin's wallet address |
___
Web3 Example:
```js
const fs = require('fs');
const solc = require('solc');
const Web3 = require('web3');

const web3 = new Web3(new Web3.providers.HttpProvider('http://localhost:8545'));
const input = fs.readFileSync('KyberNetwork.sol', 'utf8');
const output = await solc.compile(input, 1);
const bytecode = output.contracts['KyberNetwork'].bytecode;
const abi = JSON.parse(output.contracts['KyberNetwork'].interface);

const KyberNetwork = new web3.eth.Contract(JSON.parse(abi));
const _admin = '<ADMIN ADDRESS>';

const deploy = KyberNetwork.deploy({
  data: `0x${bytecode}`,
  arguments: [
    _admin
  ]
});

broadcastTx(deploy)
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `addReserve`
Adds or deletes a reserve to or from the network. Only admin can invoke.
___
function __addReserve__(KyberReserveInterface reserve, bool add) public onlyAdmin
| Parameter | Type                  | Description                                      |
| --------- |:---------------------:|:------------------------------------------------:|
| `reserve` | KyberReserveInterface | reserve's contract address                       |
| `add`     | bool                  | `true` to add reserve, `false` to remove reserve |
Modifiers: [onlyAdmin](api-permissiongroups.md#onlyadmin)
___
Web3 Example:
```js
const reserve = '0x63825c174ab367968EC60f061753D3bbD36A0D8F';
const add = true;
const tx = KyberNetwork.methods.addReserve(
  reserve,
  add
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `calcDestAmount`
Calculates the wei amount of ERC20 token to be received by the destination address.
___
function __calcDestAmount__(ERC20 src, ERC20 dest, uint srcAmount, uint rate) internal view returns (uint)
| Parameter   | Type  | Description                              |
| ----------- |:-----:|:----------------------------------------:|
| `src`       | ERC20 | source ERC20 token contract address      |
| `dest`      | ERC20 | destination ERC20 token contract address |
| `srcAmount` | uint  | wei amount of source ERC20 tokens        |
| `rate`      | uint  | conversion rate between src and dest     |
**Returns:**\
Calculated wei amount of ERC20 tokens

<br />

### `calcSrcAmount`
Calculates the wei amount of ERC20 token to be taken from the source address.
___
function __calcSrcAmount__(ERC20 src, ERC20 dest, uint destAmount, uint rate) internal view returns (uint)
| Parameter    | Type  | Description                              |
| ------------ |:-----:|:----------------------------------------:|
| `src`        | ERC20 | source ERC20 token contract address      |
| `dest`       | ERC20 | destination ERC20 token contract address |
| `destAmount` | uint  | wei amount of destination ERC20 tokens   |
| `rate`       | uint  | conversion rate between src and dest     |
**Returns:**\
Calculated wei amount of ERC20 tokens

<br />

### `doTrade`
Function that sets up the trade.
___
function __doTrade__(ERC20 src, uint srcAmount, ERC20 dest, address destAddress, uint maxDestAmount, uint minConversionRate, address walletId) internal returns (uint)
| Parameter           | Type    | Description                                                          |
| ------------------- |:-------:|:--------------------------------------------------------------------:|
| `src`               | ERC20   | source ERC20 token contract address                                  |
| `srcAmount`         | uint    | wei amount of source ERC20 token                                     |
| `dest`              | ERC20   | destination ERC20 token contract address                             |
| `destAddress`       | address | recipient address for destination ERC20 tokens                       |
| `maxDestAmount`     | uint    | max limit on the amount of destination tokens                        |
| `minConversionRate` | uint    | minimum conversion rate;  trade is canceled if actual rate is lower |
| `walletId`          | address | wallet address to send part of the fees to                           |
**Returns:**\
Amount in wei of actual destination ERC20 tokens

<br />

### `doReserveTrade`
Function that executes the actual trade.
___
function __doReserveTrade__(ERC20 src, uint amount, ERC20 dest, address destAddress, uint expectedDestAmount, KyberReserveInterface reserve, uint conversionRate, bool validate) internal returns (bool)
| Parameter            | Type                  | Description                                                   |
| -------------------- |:---------------------:|:-------------------------------------------------------------:|
| `src`                | ERC20                 | source ERC20 token contract address                           |
| `amount`             | uint                  | wei amount of source ERC20 token                              |
| `dest`               | ERC20                 | destination ERC20 token contract address                      |
| `destAddress`        | address               | recipient address for destination ERC20 token                 |
| `expectedDestAmount` | uint                  | expected wei amount of destination ERC20 token to be received |
| `reserve`            | KyberReserveInterface | address of chosen reserve                                     |
| `conversionRate`     | uint                  | the conversion rate between src and dest                      |
| `validate`           | bool                  | if `true`, additional validations are applicable              |
**Returns:**\
`true` if trade is successful, otherwise `false` if unsuccessful

<br />

### `findBestRate`
Finds the best conversion rate for a pair of tokens. If several reserves have small rate differences, pick one at random.
___
function __findBestRate__(ERC20 src, ERC20 dest, uint srcQty) public view returns (uint, uint)
| Parameter | Type  | Description                              |
| --------- |:-----:|:----------------------------------------:|
| `src`     | ERC20 | source ERC20 token contract address      |
| `dest`    | ERC20 | destination ERC20 token contract address |
| `srcQty`  | uint  | wei amount of source ERC20 token         |
**Returns:**\
Index of the best reserve and the best exchange rate for the pair
___
Web3 Example:
```js
const src = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'; // ETH
const dest = '0xdd974D5C2e2928deA5F71b9825b8b646686BD200' // KNC
const srcQty = new web3.utils.BN('3000000000000000000000');
const tx = KyberNetwork.methods.findBestRate(
  src,
  dest,
  srcQty
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `getBalance`
Get the balance of a user.
___
function __getBalance__(ERC20 token, address user) public view returns (uint)
| Parameter | Type    | Description                         |
| --------- |:-------:|:-----------------------------------:|
| `token`   | ERC20   | source ERC20 token contract address |
| `user`    | address | user's wallet address               |
**Returns:**\
ERC20 token balance of the user in wei
___
Web3 Example:
```js
const token = '0xdd974D5C2e2928deA5F71b9825b8b646686BD200' // KNC
const user = account.address;
const tx = KyberNetwork.methods.getBalance(
  token,
  user,
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `getExpectedRate`
Get the expected exchange rate.
___
function __getExpectedRate__(ERC20 src, ERC20 dest, uint srcQty) public view returns (uint expectedRate, uint slippageRate)
| Parameter | Type  | Description                              |
| --------- |:-----:|:----------------------------------------:|
| `src`     | ERC20 | source ERC20 token contract address      |
| `dest`    | ERC20 | destination ERC20 token contract address |
| `srcQty`  | uint  | wei amount of source ERC20 token         |
**Returns:**\
The expected exchange rate and slippage rate
___
Web3 Example:
```js
const src = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'; // ETH
const dest = '0xdd974D5C2e2928deA5F71b9825b8b646686BD200' // KNC
const srcQty = new web3.utils.BN('3000000000000000000000');
const tx = KyberNetwork.methods.getExpectedRate(
  src,
  dest,
  srcQty
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `getNumReserves`
Get the total number of reserves in the network.
___
function __getNumReserves__() public view returns (uint)\
**Returns:**\
Total number of reserves
___
Web3 Example:
```js
const tx = KyberNetwork.methods.getNumReserves();

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `getReserves`
Get all the reserves added in the network.
___
function __getReserves__() public view returns (KyberReserveInterface[])\
**Returns:**\
An array of all reserves' contract addresses
___
Web3 Example:
```js
const tx = KyberNetwork.methods.getReserves();

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `getUserCapInWei`
Get the user's exchange limit based on whether user has been KYC'd or not.
___
function __getUserCapInWei__(address user) public view returns (uint)
| Parameter | Type    | Description    |
| --------- |:-------:|:--------------:|
| `user`    | address | user's address |
**Returns:**\
The user's exchange limit in wei
___
Web3 Example:
```js
const user = account.address;
const tx = KyberNetwork.methods.getUserCapInWei(
  user
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `listPairForReserve`
Allow or prevent a specific reserve to trade a pair of tokens. Only admin can invoke.
___
function __listPairForReserve__(address reserve, ERC20 src, ERC20 dest, bool add) public onlyAdmin
| Parameter | Type                  | Description                                                 |
| ----------|:---------------------:|:-----------------------------------------------------------:|
| `reserve` | KyberReserveInterface | reserve's contract address                                  |
| `src`     | ERC20                 | source ERC20 token contract address                         |
| `dest`    | ERC20                 | destination ERC20 token contract address                    |
| `add`     | uint                  | `true` if trade enabled, otherwise disable trade if `false` |
Modifiers: [onlyAdmin](api-permissiongroups.md#onlyadmin)
___
Web3 Example:
```js
const reserve = '0x798AbDA6Cc246D0EDbA912092A2a3dBd3d11191B';
const src = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'; // ETH
const dest = '0xdd974D5C2e2928deA5F71b9825b8b646686BD200' // KNC
const add = true;
const tx = KyberNetwork.methods.listPairForReserve(
  reserve,
  src,
  dest,
  add
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `setEnable`
Enables or disables a reserve. Only admin can invoke.
___
function setEnable(bool \_enable) public onlyAdmin
| Parameter | Type  | Description                              |
| --------- |:-----:|:----------------------------------------:|
| `_enable` | bool  | `true` to enable reserve, `false` to disable |
Modifiers: [onlyAdmin](api-permissiongroups.md#onlyadmin)
___
Web3 Example:
```js
const _enable = true;
const tx = KyberNetwork.methods.setEnable(
  _enable,
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `setInfo`
Sets the information only used by an external UI application.
___
function setInfo(bytes32 field, uint value) public onlyOperator
| Parameter | Type    | Description                         |
| --------- |:-------:|:-----------------------------------:|
| `field`   | bytes32 | key in the `info` mapping           |
| `value`   | uint    | value to be set in the `info` field |
Modifiers: [onlyOperator](api-permissiongroups.md#onlyoperator)
___
Web3 Example:
```js
const field = 'someField';
const value = 'someValue';
const tx = KyberNetwork.methods.setInfo(
  field,
  value
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `setParams`
Sets the parameters for several contracts. Only admin can invoke.
___
function __setParams__(WhiteListInterface \_whiteList, ExpectedRateInterface \_expectedRate, FeeBurnerInterface \_feeBurner, uint \_maxGasPrice, uint \_negligibleRateDiff) public onlyAdmin
| Parameter             | Type                  | Description                                    |
| ----------------------|:---------------------:|:----------------------------------------------:|
| `_whitelist`          | WhiteListInterface    | WhiteList contract address                     |
| `_expectedRate`       | ExpectedRateInterface | ExpectedRate contract address                  |
| `_feeBurner`          | FeeBurnerInterface    | FeeBurner contract address                     |
| `_maxGasPrice`        | uint                  | maximum gas price for the `doTrade()` function |
| `_negligibleRateDiff` | uint                  | Neligible rate difference                      |
Modifiers: [onlyAdmin](api-permissiongroups.md#onlyadmin)
___
Web3 Example:
```js
const _whitelist = '0x6e106a75D369d09A9Ea1DCc16Da844792aA669a3';
const _expectedRate = '0x543f2592b1C478837B5EE2013eD26C7Fe04a8C7e';
const _feeBurner = '0x07f6e905f2a1559cD9FD43CB92F8a1062A3CA706';
const _maxGasPrice = new web3.utils.BN('50000000000');
const _negligibleRateDiff = new web3.utils.BN('350000000');


const tx = KyberNetwork.methods.setParams(
  _whitelist,
  _expectedRate,
  _feeBurner,
  _maxGasPrice,
  _negligibleRateDiff
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `trade`
Makes a trade between src and dest token and send dest tokens to destAddress.
___
function __trade__(ERC20 src, uint srcAmount, ERC20 dest, address destAddress, uint maxDestAmount, uint minConversionRate, address walletId) public payable returns (uint)
| Parameter           | Type    | Description                                   |
| ------------------- |:-------:|:--------------------------------------------------------------------:|
| `src`               | ERC20   | source ERC20 token contract address                                  |
| `srcAmount`         | uint    | wei amount of source ERC20 token                                     |
| `dest`              | ERC20   | destination ERC20 token contract address                             |
| `destAddress`       | address | recipient address for destination ERC20 token                        |
| `maxDestAmount`     | uint    | limit on the amount of destination tokens                            |
| `minConversionRate` | uint    | minimum conversion rate;  trade is canceled if actual rate is lower |
| `walletId`          | address | wallet address to send part of the fees to                           |
**Returns:**\
Amount of actual destination tokens
___
Web3 Example:
```js
const src = '0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee'; // ETH
const srcAmount = new web3.utils.BN('3000000000000000000000');
const dest = '0xdd974D5C2e2928deA5F71b9825b8b646686BD200'; // KNC
const destAddress = '<RECIPIENT ADDRESS>'
const maxDestAmount = new web3.utils.BN(Math.pow(2, 255).toString);
const minConversionRate = new web3.utils.BN('55555');
const walletId = '0x0000000000000000000000000000000000000000';


const tx = KyberNetwork.methods.trade(
  src,
  srcAmount,
  dest,
  destAddress,
  maxDestAmount,
  minConversionRate,
  walletId
);

broadcastTx(tx);
```
Code snippet reference: [broadcastTx()](appendix-codes.md#broadcasting-tx)

<br />

### `validateTradeInput`
Checks that user sent ETH or ERC20 tokens to contract before trade.
___
function __validateTradeInput__(ERC20 src, uint srcAmount, address destAddress) internal view returns (bool)
| Parameter     | Type    | Description                                   |
| ------------- |:-------:|:---------------------------------------------:|
| `src`         | ERC20   | source ERC20 token contract address           |
| `srcAmount`   | uint    | wei amount of source ERC20 token              |
| `destAddress` | address | recipient address for destination ERC20 token |
**Returns:**\
`true` if input is validated, otherwise `false` if invalidated

<br />
