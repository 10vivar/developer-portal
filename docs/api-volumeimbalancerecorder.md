---
id: VolumeImbalanceRecorder
title: VolumeImbalanceRecorder
---
# contract VolumeImbalanceRecorder
is [Withdrawable](api-withdrawable.md)\
imports [ERC20Interface](api-erc-20-interface.md), [Withdrawable](api-withdrawable.md)

*Source*: [VolumeImbalanceRecorder.sol](https://github.com/KyberNetwork/smart-contracts/blob/master/contracts/VolumeImbalanceRecorder.sol)

The VolumeImbalanceRecorder contract's role is to record the volume imbalance of a reserve. Functions are mainly internal for use by other smart contracts.
___

## INDEX

<AUTOGENERATED_TABLE_OF_CONTENTS>

## REFERENCE

### Functions

### `VolumeImbalanceRecorder`
Contract constructor. Note that constructor methods are called exactly once during contract instantiation and cannot be called again.
___
function VolumeImbalanceRecorder(address \_admin) public
| Parameter   | Type    | Description               |
| ----------- |:-------:|:-------------------------:|
| `_admin`    | address | admin's wallet address    |

<br />

### `addImbalance`
Add the volume imbalance of a ERC20 token amount.
___
function __addImbalance__(ERC20 token, int buyAmount, uint rateUpdateBlock, uint currentBlock) internal
| Parameter         | Type  | Description                          |
| ----------------- |:-----:|:------------------------------------:|
| `token`           | ERC20 | ERC20 token contract address         |
| `buyAmount`       | int   | token wei amount                         |
| `rateUpdateBlock` | uint  | block number of the last time price rates were updated for the token                    |
| `currentBlock`    | uint  | current block height or block number |

<br />

### `decodeTokenImbalanceData`
Decodes the TokenImbalanceData, which has the structure below.

```
struct TokenImbalanceData {
        int  lastBlockBuyUnitsImbalance;
        uint lastBlock;

        int  totalBuyUnitsImbalance;
        uint lastRateUpdateBlock;
    }
```
___
function __decodeTokenImbalanceData__(uint input) internal pure returns (TokenImbalanceData)
| Parameter | Type  | Description  |
| --------- |:-----:|:------------:|
| `input`   | uint  | token imbalance data  |
**Returns:**\
TokenImbalanceData comprising lastBlockBuyUnitsImbalance, lastBlock, totalBuyUnitsImbalance, and lastRateUpdateBlock

<br />

### `encodeTokenImbalanceData`
Encodes the TokenImbalanceData to the specified structure below.
```
struct TokenImbalanceData {
        int  lastBlockBuyUnitsImbalance;
        uint lastBlock;

        int  totalBuyUnitsImbalance;
        uint lastRateUpdateBlock;
    }
```
___
function __encodeTokenImbalanceData__(TokenImbalanceData data) internal pure returns (uint)
| Parameter | Type               | Description  |
| --------- |:------------------:|:------------:|
| `data`    | TokenImbalanceData | token imbalance data |
**Returns:**\
Encoded result

<br />

### `getImbalance`
Gets the imbalance data.
___
function __getImbalance__(ERC20 token, uint rateUpdateBlock, uint currentBlock) internal view returns (int totalImbalance, int currentBlockImbalance)
| Parameter         | Type  | Description                          |
| ----------------- |:-----:|:------------------------------------:|
| `token`           | ERC20 | ERC20 token contract address         |
| `rateUpdateBlock` | uint  | block number of the last time price rates were updated for the token                         |
| `currentBlock`    | uint  | current block height or block number |
**Returns:**\
Data comprising totalImbalance and currentBlockImbalance

<br />

### `getImbalanceSinceRateUpdate`
Obtain token volume imbalance since `rateUpdateBlock`
___
function __getImbalanceSinceRateUpdate__(ERC20 token, uint rateUpdateBlock, uint currentBlock) internal view returns (int buyImbalance, int currentBlockImbalance)
| Parameter         | Type  | Description                          |
| ----------------- |:-----:|:------------------------------------:|
| `token`           | ERC20 | ERC20 token contract address         |
| `rateUpdateBlock` | uint  | block number of the last time price rates were updated for the token                  |
| `currentBlock`    | uint  | current block height or block number |
**Returns:**\
Data comprising buyImbalance and currentBlockImbalance

<br />

### `getMaxPerBlockImbalance`
Obtain maximum wei amount of net absolute (+/-) change for a token in an ethereum block
___
function __getMaxPerBlockImbalance__(ERC20 token) internal view returns (uint)
| Parameter         | Type  | Description                  |
| ----------------- |:-----:|:----------------------------:|
| `token`           | ERC20 | ERC20 token contract address |
**Returns:**\
Maximum wei amount of net absolute (+/-) change for a token in an ethereum block

<br />

### `getMaxTotalImbalance`
Obtain wei amount of the maximum net token change allowable that happens between 2 price updates
___
function __getMaxTotalImbalance__(ERC20 token) internal view returns (uint)
| Parameter         | Type  | Description                  |
| ----------------- |:-----:|:----------------------------:|
| `token`           | ERC20 | ERC20 token contract address |
**Returns:**\
Wei amount of the maximum net token change allowable that happens between 2 price updates

<br />

### `getTokenControlInfo`
Obtain `minimalRecordResolution`, `maxPerBlockImbalance` and `maxTotalImbalance` of an ERC20 token
___
function __getTokenControlInfo__(ERC20 token) public view returns (uint, uint, uint)
| Parameter         | Type  | Description                  |
| ----------------- |:-----:|:----------------------------:|
| `token`           | ERC20 | ERC20 token contract address |
**Returns:**\
1. minimalRecordResolution
2. maxPerBlockImbalance
3. maxTotalImbalance

<br />

### `setGarbageToVolumeRecorder`
Sets arbitary values for token imbalance data
___
function __setGarbageToVolumeRecorder__(ERC20 token) internal
| Parameter         | Type  | Description                  |
| ----------------- |:-----:|:----------------------------:|
| `token`           | ERC20 | ERC20 token contract address |

<br />

### `setTokenControlInfo`
Set the `minimalRecordResolution`, `maxPerBlockImbalance` and `maxTotalImbalance` of an ERC20 token
___
function __setTokenControlInfo__(ERC20 token, uint minimalRecordResolution, uint maxPerBlockImbalance, uint maxTotalImbalance) public
| Parameter                 | Type  | Description                  |
| ------------------------- |:-----:|:----------------------------:|
| `token`                   | ERC20 | ERC20 token contract address |
| `minimalRecordResolution` | uint  | minimum denominator in token wei that can be changed                |
| `maxPerBlockImbalance`    | uint  |  maximum wei amount of net absolute (+/-) change for a token in an ethereum block              |
| `maxTotalImbalance`       | uint  | wei amount of the maximum net token change allowable that happens between 2 price updates                 |
Modifiers: [onlyAdmin](api-permissiongroups.md#onlyadmin)\
**Returns:**\
Data comprising minimalRecordResolution, maxPerBlockImbalance, and maxTotalImbalance

<br />
